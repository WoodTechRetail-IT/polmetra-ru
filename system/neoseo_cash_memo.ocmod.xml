<?xml version="1.0" encoding="UTF-8"?>
<modification>
    <name>NeoSeo CashMemo</name>
    <version>38</version>
    <code>neoseo-cash-memo</code>
    <author>Alexander Sorokin</author>
    <link>http://seomag.com.ua/moduli/moduli-obrabotki-zakazov/neoseo-cash-memo</link>

    <file path="admin/controller/sale/order.php">
        <operation>
            <search><![CDATA[$data['shipping']]]></search>
            <add position="after"><![CDATA[
            /* NeoSeo CashMemo - begin */
            $this->language->load('sale/neoseo_cash_memo_order');
		    $data['button_neoseo_cash_memo'] = $this->language->get('button_neoseo_cash_memo');
		    $data['neoseo_cash_memo_replace_status'] = $this->config->get('neoseo_cash_memo_replace_status');

		    $data['neoseo_cash_memo_invoice_status'] = $this->config->get('neoseo_cash_memo_invoice_status');
		    $data['button_neoseo_product_order'] = $this->language->get('button_neoseo_product_order');
		    $data['neoseo_cash_memo_product_order_status'] = $this->config->get('neoseo_cash_memo_product_order');
            if( isset( $this->request->get['order_id'] ) ) {
		        $data['neoseo_cash_memo'] = $this->url->link('sale/neoseo_cash_memo', 'user_token=' . $this->session->data['user_token'] . '&order_id=' . $this->request->get['order_id'], 'SSL');
		        $data['neoseo_cash_memo_product_order'] = $this->url->link('sale/neoseo_cash_memo', 'user_token=' . $this->session->data['user_token'] . '&order_id=' . $this->request->get['order_id'] . '&product_order=1', 'SSL');
		    } else {
		        $data['neoseo_cash_memo'] = $this->url->link('sale/neoseo_cash_memo', 'user_token=' . $this->session->data['user_token'], 'SSL');
		        $data['neoseo_cash_memo_product_order'] = $this->url->link('sale/neoseo_cash_memo', 'user_token=' . $this->session->data['user_token'] . '&product_order=1', 'SSL');
		    }


		    if ( $data['neoseo_cash_memo_replace_status'] ) {
		        $data['invoice'] = $this->url->link('sale/neoseo_cash_memo', 'user_token=' . $this->session->data['user_token'], 'SSL');
		        $data['button_invoice_print'] = $data['button_neoseo_cash_memo'];
		    }
            /* NeoSeo CashMemo - end */
            ]]></add>
        </operation>
    </file>

    <file path="admin/view/template/sale/order_info.twig">
        <operation>
            <search>
                <![CDATA[<a href="{{ invoice }}" target="_blank" data-toggle="tooltip" title="{{ button_invoice_print }}" class="btn btn-info"><i class="fa fa-print"></i></a>]]></search>
            <add position="replace"><![CDATA[
            {% if neoseo_cash_memo_invoice_status is defined %}
                 <a href="{{ neoseo_cash_memo }}" target="_blank" data-toggle="tooltip" title="{{ button_neoseo_cash_memo }}" class="btn btn-info"><i class="fa fa-print"></i></a>{% if neoseo_cash_memo_replace_status == 0 %}<a href="{{ invoice }}" target="_blank" data-toggle="tooltip" title="{{ button_invoice_print }}" class="btn btn-info"><i class="fa fa-print"></i></a>{% endif %}
            {% endif %}
            {% if neoseo_cash_memo_product_order_status is defined %}

            <a href="{{ neoseo_cash_memo_product_order }}" target="_blank" data-toggle="tooltip" title="{{ button_neoseo_product_order }}" class="btn btn-info"><i class="fa fa-list-alt"></i></a>
           {% endif %}
            ]]></add>
        </operation>
    </file>

    <file path="admin/view/template/sale/order_list.twig">
        <operation>
            <search>
                <![CDATA[<button type="submit" id="button-invoice" form="form-order" formaction="{{ invoice }}" formtarget="_blank" data-toggle="tooltip" title="{{ button_invoice_print }}" class="btn btn-info"><i class="fa fa-print"></i></button>]]></search>
            <add position="replace"><![CDATA[        <button type="submit" id="button-invoice" form="form-order" formaction="{{ invoice }}" data-toggle="tooltip" title="{{ button_invoice_print }}" class="btn btn-info"><i class="fa fa-print"></i></button>
        {% if ( neoseo_cash_memo_replace_status == 0 ) %}
        <button type="submit" id="button-invoice2" form="form-order" formaction="{{ neoseo_cash_memo }}" data-toggle="tooltip" title="{{ button_neoseo_cash_memo }}" class="btn btn-info"><i class="fa fa-print"></i></button>
        {% endif %}
            ]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $('#button-invoice').prop('disabled', false);
            ]]></search>
            <add position="after"><![CDATA[        $('#button-invoice2').prop('disabled', false);]]></add>
        </operation>
        <operation>
            <search><![CDATA[
            $('#button-shipping, #button-invoice').prop('disabled', true);
            ]]></search>
            <add position="after"><![CDATA[	$('#button-invoice2').prop('disabled', true);]]></add>
        </operation>

    </file>


    <file path="catalog/controller/account/order.php">
        <operation>
            <search><![CDATA[if ($order_info['invoice_no']) {]]></search>
            <add position="before"><![CDATA[
            /* NeoSeo CashMemo - begin */
		$this->language->load('account/neoseo_cash_memo_order');
		$data['button_neoseo_cash_memo'] = $this->language->get('button_neoseo_cash_memo');
		$data['neoseo_cash_memo_client_side'] = $this->config->get('neoseo_cash_memo_client_side');

		 $data['neoseo_cash_memo_invoice_status'] = $this->config->get('neoseo_cash_memo_invoice_status');
		 $data['button_neoseo_product_order'] = $this->language->get('button_neoseo_product_order');
		 $data['neoseo_cash_memo_product_order_client'] = $this->config->get('neoseo_cash_memo_product_order_client');
		 $data['neoseo_cash_memo_product_order_status'] = $this->config->get('neoseo_cash_memo_product_order');

		if( isset( $order_id ) ) {
			$data['neoseo_cash_memo'] = $this->url->link('account/neoseo_cash_memo','order_id=' . $order_id , 'SSL');
			$data['neoseo_cash_memo_product_order'] = $this->url->link('account/neoseo_cash_memo','order_id=' . $order_id  . '&product_order=1', 'SSL');
			$data['invoice'] = $this->url->link('account/neoseo_cash_memo','order_id=' . $order_id , 'SSL');
			$data['button_invoice_print'] = $data['button_neoseo_cash_memo'];
		} else {
			$data['neoseo_cash_memo'] = $this->url->link('account/neoseo_cash_memo','', 'SSL');
			$data['neoseo_cash_memo_product_order'] = $this->url->link('account/neoseo_cash_memo','&product_order=1', 'SSL');
		}
		/* NeoSeo CashMemo - end */
            ]]></add>
        </operation>
    </file>

    <file path="catalog/view/theme/default/template/account/order_info.twig">
        <operation>
            <search><![CDATA[<div id="content" class="{{ class }}">{{ content_top }}]]></search>
            <add position="after"><![CDATA[
            <!-- NeoSeo CashMemo - begin -->
            {% if (neoseo_cash_memo_invoice_status and neoseo_cash_memo_client_side) %}
                <div class="pull-right"><a href="{{ invoice }}" target="_blank" data-toggle="tooltip" title="{{ button_invoice_print }}" class="btn btn-info"><i class="fa fa-print"></i></a>
                </div>
            {% endif %}
            {% if (neoseo_cash_memo_product_order_status and neoseo_cash_memo_product_order_client) %}
                <div class="pull-right"><a href="{{ neoseo_cash_memo_product_order }}" target="_blank" data-toggle="tooltip" title="{{ button_neoseo_product_order }}" class="btn btn-info"><i class="fa fa-list-alt"></i></a><span>&nbsp;</span>
                </div>
            {% endif %}
            <!-- NeoSeo CashMemo - end -->
            ]]></add>
        </operation>
    </file>

</modification>